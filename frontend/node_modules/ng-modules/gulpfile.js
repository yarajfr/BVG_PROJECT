const gulp = require("gulp");
const del = require("del");
const fs = require("fs");
const clean = require("gulp-clean");

const paths = {
  src: ["src/**/*.*"],
  html: ["src/**/*.html"],
  version: "./package.json",
}

gulp.task("clean", () => {
  return gulp.src("_src/**/*", {
      read: false
    })
    .pipe(clean());
})

gulp.task("copy", () => {
  return gulp.src(paths.src)
    .pipe(gulp.dest('_src'))
})

gulp.task("version", () => {
  let app = fs.readFileSync(paths.version);
  try {
    app = JSON.parse(app)
  } catch (e) {
    app = "";
  }
  if (app) {
    app.version = app.version.split(".");
    let num = app.version[app.version.length - 1];
    app.version = (app.version[app.version.length - 1] = ++num, app.version)
    app.version = app.version.join(".");
  }
  fs.writeFileSync(paths.version, JSON.stringify(app, null, 4));
})
