import { Injectable } from "@angular/core";

@Injectable()
export class DomProvider {

	constructor() { }

	/**
	 * 检查节点是否属于某个节点的子节点
	 */
	checkIsParent(parent: HTMLElement, child: HTMLElement): boolean {
		let is = false;
		while (parent.parentNode) {
			if (parent == child) {
				is = true;
				break;
			} else if (child) {
				child = child.parentElement;
				if (child == document.body) {
					break;
				}
				if (child == document.documentElement) {
					break;
				}
			}
		}
		return is;
	}

	/**
	 * 检查某个节点是否滚动到顶/底
	 * @param direction 滚动方向 -1 表示向下，1 表示向上
	 */
	checkIsScrollToEnd(element: HTMLElement, direction: -1 | 1) {
		let parent: HTMLElement = element;
		while (parent.clientHeight == parent.scrollHeight) {
			if (parent.offsetParent) {
				parent = parent.offsetParent as any
			} else {
				break;
			}
			if (parent == document.body || parent == document.body.parentElement || parent == document.documentElement) {
				break
			}
		}
		if (!parent) {
			return 0;
		}
		let scrollTop = parent.scrollTop;
		let viewHeight = (parent as any).offsetHeight;
		let height = parent.scrollHeight;
		if (scrollTop == 0 && direction == 1) {
			return 1;
		} else if (scrollTop + viewHeight >= height && direction == -1) {
			return -1;
		} else {
			return 0;
		}
	}

}